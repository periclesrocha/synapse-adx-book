{
	"name": "Managing extents",
	"properties": {
		"folder": {
			"name": "Chapter 13"
		},
		"content": {
			"query": "// 1. Reviewing the database merge policy\n\n.show database ['drone-telemetry'] policy merge\n\n// 2. Adding tags at ingestion time\n\n// 2.a - we will create a destination table first to perform data ingestion.  \n\n.create table ['fleet data with tags'] (\n    DeviceData: string, \n    LocalDateTime: string, \n    DeviceState: string, \n    CoreTemp: long, \n    CoreStatus: string, \n    Compass: long, \n    Altitude: long, \n    Speed: long, \n    PayloadWeight: long, \n    EventData: string\n) \n\n// 2.b - Now, we'll perform ingestion with tags. \n\n.ingest into table ['fleet data with tags']\n    'https://dronetelemetrydatalake.blob.core.windows.net/raw-data/drone-telemetry-simplified.csv?sp=r&st=2022-12-23T12:35:01Z&se=2022-12-30T20:35:01Z&spr=https&sv=2021-06-08&sr=c&sig=8OFOuVnfha0%2BqhDF2eIqfNJlm5xl33BGDTmnxXjxTGc%3D' \n    with (ignoreFirstRecord=true, tags='[\"drop-by:2023-03-23\"]') \n\n// 3. Altering tags on all extents of a table\n\n.alter extent tags ('Drone telemetry data. Do not delete.') <| .show table ['fleet data with tags'] extents\n\n// 4. Adding tags on all extents of a table\n\n.alter-merge extent tags ('Data source: telemetry data lake.') <| .show table ['fleet data with tags'] extents\n\n// 5. Reviewing extent tags\n\n.show table ['fleet data with tags'] extents\n| project ExtentId, Tags\n\n// 6. Moving extents. \n// 6.a We'll create a new table first. \n\n.create table ['fleet data with tags - archive'] (\n    DeviceData: string, \n    LocalDateTime: string, \n    DeviceState: string, \n    CoreTemp: long, \n    CoreStatus: string, \n    Compass: long, \n    Altitude: long, \n    Speed: long, \n    PayloadWeight: long, \n    EventData: string\n) \n\n// 6.b Now we'll move all extents from one table to the other.\n\n.move extents all from table ['fleet data with tags'] to table ['fleet data with tags - archive']\n\n// 6.c Move specific extents.\n\n.move extents from table ['fleet data with tags - archive'] to table ['fleet data with tags'] (ee5ae751-9a79-488a-acd8-ccf58b315479)\n\n// 6.d Move extents based on their tags.\n\n.move extents to table ['fleet data with tags - archive'] <| .show table ['fleet data with tags'] extents | where Tags == 'drop-by:2023-03-23'\n\n\n\n\n",
			"metadata": {
				"language": "kql"
			},
			"currentConnection": {
				"poolName": "droneanalyticsadx",
				"databaseName": "drone-telemetry"
			}
		},
		"type": "KqlQuery"
	}
}