{
	"name": "Purging personal data",
	"properties": {
		"folder": {
			"name": "Chapter 13"
		},
		"content": {
			"query": "//1. Purging data from a table\n\n// 1.a - Start the purge process by retrieving the verification token\n\n.purge table ['fleet data with tags - archive'] records \n    in database ['drone-telemetry'] <| where todatetime(LocalDateTime) > now() - time(405d)\n\n// 1.b - Confirm the verification code and start data purge\n\n.purge table ['fleet data with tags - archive'] records in database ['drone-telemetry'] with (verificationtoken=h'eyJEYXRhYmFzZU5hbWUiOiJkcm9uZS10ZWxlbWV0cnkiLCJUYWJsZU5hbWUiOiJmbGVldCBkYXRhIHdpdGggdGFncyAtIGFyY2hpdmUiLCJQcmVkaWNhdGUiOiJ3aGVyZSB0b2RhdGV0aW1lKExvY2FsRGF0ZVRpbWUpID4gbm93KCkgLSB0aW1lKDQwNWQpIn0=') <| where todatetime(LocalDateTime) > now() - time(405d)\n\n// 1.c - Monitoring the status of purge operations\n.show purges 8790d693-0ce1-4262-8331-dc48e853eebf\n\n// 1.d - Showing all data purges on a given database \n\n.show purges in database ['drone-telemetry']\n\n// 1.d - Showing all data purges on a given database, in a time range \n\n.show purges from '2022-12-19 00:00' to '2022-12-24 23:59' in database ['drone-telemetry']\n\n// 1.e - Showing all data purges on a given database, in since a certain date \n\n.show purges from '2022-12-19 00:00' in database ['drone-telemetry']\n\n// 2. Single-step purge\n\n.purge table ['fleet data with tags - archive'] records in database ['drone-telemetry'] with (noregrets='true') \n<| where CoreTemp < 3",
			"metadata": {
				"language": "kql"
			},
			"currentConnection": {
				"poolName": "droneanalyticsadx",
				"databaseName": "drone-telemetry"
			}
		},
		"type": "KqlQuery"
	}
}