{
	"name": "KQL examples",
	"properties": {
		"folder": {
			"name": "Chapter 6"
		},
		"content": {
			"query": "// All rows, selecting a few columns\n['fleet data']\n| project DeviceData, LocalDateTime, DeviceState, CoreTemp, BatteryTemp, Speed\n\n// Picking only five rows - limit and take are the same\n['fleet data']\n| take 5\n| project DeviceData, LocalDateTime, DeviceState, CoreTemp, BatteryTemp, Speed\n\n// Take has no order, so how do we pick the first few rows? \n['fleet data']\n| top 5 by LocalDateTime asc\n| project DeviceData, LocalDateTime, DeviceState, CoreTemp, BatteryTemp, Speed\n\n// Filtering with where\n['fleet data']\n| where LocalDateTime >= datetime(2021-09-27) and LocalDateTime  <= datetime(2021-09-29)\n| project DeviceData, LocalDateTime, DeviceState, CoreTemp, BatteryTemp, Speed\n\n// Sorting\n['fleet data']\n| where LocalDateTime >= datetime(2021-09-27) and LocalDateTime  <= datetime(2021-09-29)\n| sort by CoreTemp desc\n| project DeviceData, LocalDateTime, DeviceState, CoreTemp, BatteryTemp, Speed\n\n// Derived columns using extend\n['fleet data']\n| limit 5\n| extend Hour = datetime_part(\"Hour\", LocalDateTime), Minute = datetime_part(\"Minute\", LocalDateTime)\n| project Hour, Minute, LocalDateTime\n\n// Aggregations \n['fleet data']\n| summarize average_speed= avg(Speed) by DeviceState\n| order by average_speed desc\n\n// Which days did we have the most deliveries?\n['fleet data']\n| where DeviceState == 'Delivery'\n| summarize event_count = count() by bin(LocalDateTime, 1d)\n| order by event_count desc \n\n// Can I put that in a chart?\n['fleet data']\n| where DeviceState == 'Delivery'\n| summarize event_count = count() by bin(LocalDateTime, 1d)\n| project LocalDateTime, event_count\n| order by event_count desc \n| render timechart  \n\n// Average temperature per DeviceState each day\n// It looks like errors happen when temperature spike, or is too low \n['fleet data']\n// 2021-09-27T00:00:00.000000Z\n| where LocalDateTime >= datetime(2021-09-27T00:00:00.000000Z) and LocalDateTime <= datetime(2021-09-27T23:59:59.999999Z)\n| summarize event_count = avg(CoreTemp) by bin(LocalDateTime, 1h), DeviceState\n| render timechart  \n\n// Can I render here? \n['fleet data']\n| summarize temp = avg(CoreTemp) by DeviceState\n| project  DeviceState, temp\n| order by temp desc\n| render columnchart  \n\n// Percentiles\n['fleet data']\n| summarize percentiles(CoreTemp, 10, 20, 30, 40, 50, 60, 70, 80, 90)\n\n// Percentages - using variables\n// Calculate failures\n['fleet data']\n\n\n",
			"metadata": {
				"language": "kql"
			},
			"currentConnection": {
				"poolName": "droneanalyticsadx",
				"databaseName": "drone-telemetry"
			}
		},
		"type": "KqlQuery"
	}
}